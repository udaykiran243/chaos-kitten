# Secret Exposure Attack Profile
# Tests for exposed secrets, configuration files, and stack traces

name: "Secret Exposure & Config Leak"
category: "secret_exposure"
severity: "high"
description: >
  Tests for exposed configuration files, environment variables, 
  and endpoints that might leak secrets via stack traces or debug info.

# Attack payloads to test
payloads:
  # --- Config Files ---
  - ".env"
  - ".git/config"
  - "config.json"
  - "config.yml"
  - "settings.py"
  - "wp-config.php"
  - "web.config"
  - "appsettings.json"
  - "server.xml"

  # --- Cloud Metadata ---
  - "http://169.254.169.254/latest/meta-data/"
  - "http://169.254.169.254/latest/user-data/"

  # --- Force Error / Stack Trace ---
  # These inputs aim to cause unhandled exceptions that might leak env vars
  - "' OR 1=1 --"
  - "{{7*7}}"
  - "%00"
  - "undefined"
  - "NaN"

# Indicators that suggest successful exploitation
success_indicators:
  response_contains:
    - "AWS_ACCESS_KEY_ID"
    - "DB_PASSWORD"
    - "API_KEY"
    - "-----BEGIN RSA PRIVATE KEY-----"
    - "root:x:0:0:root"
    - "Authorization:"
    - "INTERNAL_SERVER_ERROR" # Often accompanied by stack traces in dev mode
  status_codes:
    - 200
    - 500 # Errors are interesting here if they leak info

# How to fix this vulnerability
remediation: |
  1. **Disable Directory Listing**: Ensure web server doesn't list file contents.
  2. **Block Sensitive Files**: Configure WAF or server to deny access to `.*` files (like `.env`, `.git`).
  3. **Disable Debug Mode**: Ensure `DEBUG=False` in production to prevent stack traces.
  4. **Use Secrets Manager**: Do not store secrets in code or config files committed to repo.
  
references:
  - "https://owasp.org/www-project-top-ten/2017/A3_2017-Sensitive_Data_Exposure"
